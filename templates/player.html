<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body { 
      margin:0; color:#fff; font-family: Inter, sans-serif; 
      min-height:100vh; display:flex; flex-direction:column; position:relative;
      background: url("https://graph.org/file/307d5dd37cbfb9738b41a-6cf2524b08e006f7bf.jpg") no-repeat center center fixed;
      background-size: cover;
    }
    body::before {
      content:""; position:absolute; top:0; left:0; right:0; bottom:0;
      background:linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0));
      z-index:0;
    }

    .app-header, .player-screen, footer { position:relative; z-index:1; }
    .app-header { 
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 18px; font-size:18px; font-weight:700; 
      background:rgba(0,0,0,0.3);
    }
    .listeners { font-size:13px; color:#ddd; }
    .player-screen { flex:1; padding-bottom:90px; text-align:center; }

    /* Circular Progress Ring */
    .album-wrap {
      margin:20px auto; position:relative;
      width:280px; height:280px;
      display:flex; align-items:center; justify-content:center;
    }
    .album-ring {
      position:absolute; top:0; left:0; right:0; bottom:0;
      border-radius:50%; padding:8px;
      background:conic-gradient(#6ea5ff 0deg, #a66bff 0deg, #ff6ea5 0deg, #333 0deg 360deg);
      display:flex; align-items:center; justify-content:center;
      transition: background 0.3s linear;
      overflow:hidden;
    }
    /* Rainbow Neon Sweep */
    .album-ring::after {
      content:""; position:absolute; inset:-5px; border-radius:50%;
      background:conic-gradient(
        rgba(255,0,0,0.6),
        rgba(255,165,0,0.6),
        rgba(255,255,0,0.6),
        rgba(0,255,0,0.6),
        rgba(0,255,255,0.6),
        rgba(0,0,255,0.6),
        rgba(255,0,255,0.6),
        rgba(255,0,0,0.6)
      );
      filter: blur(14px);
      opacity:0.7;
      animation: rotateSweep 5s linear infinite, hueShift 6s linear infinite;
      z-index:1;
      mix-blend-mode:screen;
    }
    @keyframes rotateSweep {
      from { transform:rotate(0deg); }
      to { transform:rotate(360deg); }
    }
    @keyframes hueShift {
      from { filter: blur(14px) hue-rotate(0deg); }
      to { filter: blur(14px) hue-rotate(360deg); }
    }
    .album-wrap img {
      width:240px; height:240px; border-radius:50%;
      object-fit:cover; border:6px solid #111; z-index:2;
    }

    .track-info { margin-top:12px; }
    .track-title { font-size:18px; font-weight:700; }
    .track-artist { font-size:14px; color:#ccc; }
    .listeners-row { display:flex; justify-content:center; gap:6px; margin:12px 0; }
    .listeners-row img { width:32px; height:32px; border-radius:50%; border:2px solid #444; }

    /* Profile Section */
    .user-profile { 
      display:flex; align-items:center; gap:12px;
      margin:20px auto; max-width:320px;
      background:rgba(0,0,0,0.6); padding:12px 16px; border-radius:12px;
    }
    .user-profile img { width:50px; height:50px; border-radius:50%; }
    .user-profile h3 { margin:0; font-size:16px; }
    .user-profile p { margin:0; font-size:13px; color:#bbb; }

    /* Seek Progress Bar */
    .progress { display:flex; align-items:center; justify-content:center; gap:10px; margin:15px 0; }
    .progress input[type=range] {
      -webkit-appearance:none; width:60%; height:8px; border-radius:8px;
      background:#444; outline:none;
    }
    .progress input[type=range]::-webkit-slider-thumb {
      -webkit-appearance:none; width:16px; height:16px; border-radius:50%;
      background:#fff; border:2px solid #ff6ea5; cursor:pointer;
      position:relative; z-index:2;
    }

    .controls { margin:10px 0; }
    .controls button { margin:0 6px; font-size:20px; background:none; border:none; color:#fff; cursor:pointer; }
    .fav-btn { font-size:20px; background:none; border:none; cursor:pointer; color:red; }

    /* Volume Slider */
    .volume-row { margin:15px 0; }
    .volume-row input[type=range] {
      -webkit-appearance:none; width:60%; height:8px; border-radius:8px;
      background:#444; outline:none;
    }
    .volume-row input[type=range]::-webkit-slider-thumb {
      -webkit-appearance:none; width:16px; height:16px; border-radius:50%;
      background:#fff; border:2px solid #a66bff; cursor:pointer;
      position:relative; z-index:2;
    }
    .volume-row span { display:block; margin-top:6px; font-size:14px; color:#ddd; }

    footer { 
      position:fixed; bottom:0; left:0; right:0;
      background:rgba(0,0,0,0.7);
      display:flex; justify-content:space-around; padding:12px 0;
    }
    footer a { text-decoration:none; color:#fff; font-size:16px; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <div>üé∂ BAD MUSIC</div>
    <div class="listeners"><span id="listenerCount">0</span> listeners</div>
  </header>

  <!-- Player -->
  <main class="player-screen">
    <div class="album-wrap">
      <div class="album-ring" id="albumRing"></div>
      <img id="player-thumb" src="{{ thumb }}" alt="Album">
    </div>

    <div class="track-info">
      <div class="track-title" id="title">{{ title }}</div>
      <div class="track-artist" id="artist">{{ artist }}</div>
    </div>

    <div class="listeners-row" id="listenersRow"></div>

    <!-- Progress Bar -->
    <div class="progress">
      <span id="current">0:00</span>
      <input id="seek" type="range" min="0" max="100" value="0" />
      <span id="total">0:00</span>
    </div>

    <div class="controls">
      <button class="ctrl" onclick="rewind()">‚èÆ</button>
      <button id="playBtn" class="play-prim" onclick="togglePlay()">‚èµ</button>
      <button class="ctrl" onclick="forward()">‚è≠</button>
      <button id="favBtn" class="fav-btn">‚ù§Ô∏è</button>
    </div>

    <!-- Volume -->
    <div class="volume-row">
      <input type="range" id="volume" min="0" max="1" step="0.05" value="0.8" />
      <span id="volPercent">80%</span>
    </div>

    <!-- Profile -->
    <section class="user-profile">
      <img id="profile-pic" src="https://via.placeholder.com/60" alt="Profile">
      <div>
        <h3 id="profile-name">Guest</h3>
        <p id="profile-username">@guest</p>
      </div>
    </section>

    <audio id="audio" preload="auto" src="{{ audio_url }}"></audio>
  </main>

  <!-- Footer -->
  <footer>
    <a href="/"><span>üè† Room</span></a>
    <a href="/me?uid=guest"><span>üë§ Me</span></a>
  </footer>

  <!-- Scripts -->
  <script>
    const audio = document.getElementById("audio");
    const seek = document.getElementById("seek");
    const current = document.getElementById("current");
    const total = document.getElementById("total");
    const albumRing = document.getElementById("albumRing");
    const vol = document.getElementById("volume");
    const volPercent = document.getElementById("volPercent");

    function fmtTime(sec) {
      const m = Math.floor(sec/60) || 0;
      const s = Math.floor(sec%60) || 0;
      return m + ":" + (s<10?"0":"") + s;
    }

    audio.addEventListener("loadedmetadata", () => {
      seek.max = Math.floor(audio.duration);
      total.textContent = fmtTime(audio.duration);
    });

    audio.addEventListener("timeupdate", () => {
      seek.value = Math.floor(audio.currentTime);
      current.textContent = fmtTime(audio.currentTime);

      // Circular ring progress
      const progress = (audio.currentTime / audio.duration) * 360;
      albumRing.style.background = `conic-gradient(#6ea5ff 0deg ${progress/3}deg, #a66bff ${progress/3}deg ${progress*2/3}deg, #ff6ea5 ${progress*2/3}deg ${progress}deg, #333 ${progress}deg 360deg)`;

      // Seekbar colorful fill
      const percent = (audio.currentTime / audio.duration) * 100;
      seek.style.background = `linear-gradient(90deg, #6ea5ff, #a66bff, #ff6ea5 ${percent}%, #444 ${percent}%)`;
    });

    seek.addEventListener("input", () => { audio.currentTime = seek.value; });

    // Volume gradient fill
    function updateVolumeUI() {
      const percent = vol.value * 100;
      volPercent.textContent = Math.round(percent) + "%";
      vol.style.background = `linear-gradient(90deg, #6ea5ff, #a66bff, #ff6ea5 ${percent}%, #444 ${percent}%)`;
    }
    audio.volume = vol.value;
    updateVolumeUI();
    vol.addEventListener("input", () => { audio.volume = vol.value; updateVolumeUI(); });
  </script>
</body>
</html>
